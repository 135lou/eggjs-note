# egg 启动流程 【待续...】
 

## egg启动流程

### 流程图
```sh


    +-------------------+          +----------------------------+          +--------------------------+
    |                   |          |                            |          |                          |
    |   egg-bin dev     +--------> |  egg-cluster startCluster  +--------> |  maser                   +------------+
    |                   |          |                            |          |                          |            |
    +-------------------+          +----------------------------+          +--------------------------+            |
                                                                                                                   |
                                                                                                                   |
                                                                                                                   |
                        +-------------------------------+         +----------------------------------+             |
                        |                               |         |                                  |             |
                        |  agentWorkerLoader            | <-------+  agent_worker  new [Agent]       | <------+    |
                        |                               |         |                                  |        |    |
                        +-------------------------------+         +----------------------------------+        |    |
                                                                                                              +----+
                                                                                                              |
                        +-------------------------------+         +----------------------------------+        |
                        |                               |         |                                  |        |
                        |  appWorkerLoader              | <-------+  app_worker new [Application]    | <------+
                        |                               |         |                                  |
                        +-------------------------------+         +----------------------------------+




```

### 流程详解

>注：以启动 `npm run dev`为例

- 在项目目录下启动`npm run dev`执行了`egg-bin dev`
- `egg-bin` 命令执行了 `egg`的`startCluster()`方法
- `startCluster`是直接引用 `require('egg-cluster').startCluster`
- `egg-cluster`模块启动了两种`worker`
  - agent_worker
    - `egg.Agent()`
    - 用于进程守护和其他非业务操作
  - app_worker
    - `egg.Application()`
    - 业务操作进程
